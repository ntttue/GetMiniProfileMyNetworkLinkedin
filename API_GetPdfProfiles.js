var profileId = ["nguyenta", "christophelefebvre", "nghia-doan-a5402534", "guydelussigny", "h%E1%BB%93ngtr%C3%A2n", "minhthach", "tuananhnguyenkk", "hungbinh", "lancehendrix", "hungb", "minh-duc-nguyen-b456191", "quang-vu-xuan-1988871", "longnh", "kevin-koh-75747b2", "kimkngo", "mickrasmussen", "nhonpt", "trongton", "michealclaxton", "phan-thanh-84b4553", "suprio", "liem-doan-2038253", "vincentgirard", "vu-nguyen-43515231", "myomyint", "vinhquach", "jakenguyen", "igorkotler", "leon-mai-cspo-71011b4", "dbamunna", "hoangtrungkien", "michelelafortezza", "leminhvn", "tuong-nguyen-1724984", "trung-pham-phu-5444a54", "nguyen-minh-phuong-8b4b254", "bangtn", "l%C3%AA-quang-h%C3%B9ng-0863105", "hung-tran-120408123", "dzieu-huynh-7b64005", "ricardoglenn", "nguyen-truc-6aa0586", "bang-ngo-1a212b6", "kentran27", "chon-nguyen-huu-b0b3396", "huanduong", "trung-le-thanh-22a5316", "dale-brown-5268a86", "nhu-trang-dang-4a49696", "plamentetevensky", "phuong-nguyentm-8532617", "thongdo", "phamthuycamtu", "tam-nguyen-a2058220", "mustufa-rangwala-odoo-openerp-0a46777", "haisergeant", "huongtnguyen", "trungrwo", "cuongerp", "baolannguyen", "levantai", "hoa-nguyen-huu-4320818", "hong-phuc-nguyen-a372018", "david-vanhove-b663468", "nguyenthanhthanh", "duy-pham-1194458", "bao-nguyen-b2b500123", "quyen-nguyen-4064908", "wordpresswebsitedesigner", "lanka-bogoda", "vovietanh", "hien-nguyen-ma-2225b28", "leonardobuscaroli", "tuoi-nguyen-4709638", "thuyanhtran411", "tintrang", "nicolas-phalippoux-634ab78", "oanh-nguyen-8a70489", "vohuyhoang", "nguyentuananh", "timaman", "mylinhtrant", "nguyenvuhung", "tuan-nguyen-chi-2534769", "itutruong", "dinhledat", "tuanepi", "jack-gerard-4367059", "khoidang", "nhung-do-4357699", "tran-nguyen-vu-a667829", "ledacliem", "nhan-quoc-vinh-7aa8a59", "chaungoclinh", "nghiadang", "hop-luu-a50590a", "thomas-n-0b5591a", "lam-nguyen-693640a", "ngoc-quy-tran-27380ba", "quyluong", "phuong-doan-09403bb", "tamnguyen0707", "nghito", "trinhkien", "ha-pham-539335b", "sangtran", "vu-hai-anh-6ba491b", "lethikim", "huong-huynh-4aa60bb", "zenius", "tan-loc-truong-b47a75b", "sonnykt", "madebyquan", "iapilgrim", "shiva2610", "hoang-vo-minh-79a52410", "minhnguyen2010", "gabriel-lica-1548a810", "txhong", "linh-vu-3b007911", "traphucvinhuy", "nguyen-phi-son-20253111", "vutrungtran", "igorlakoza", "phan-cong-a1b91111", "tran-thi-thanh-thuy-5299ab11", "trungduong", "thanh-mai-dang-780b1111", "thao-mai-754b6411", "nghia-doan-59706912", "loan-nguyen-29613012", "quang-sang-tan-a4835812", "thuy-ha-van-3383a812", "snackcoca", "nguyen-anh-quan-01a55812", "huy-le-ngoc-quoc-5875a712", "ducnguyen1911", "nguyen-kim-mai-thu-42962412", "langbatkyho", "ella-nguyen-0ba68712", "luongthevinh", "xuanvinhnguyen", "trung-khuong-13975812", "daoquanganh", "chauhuynh", "danghuuanh", "ramijronaldviitaniemi", "ngohaianh", "hoongdt", "thang-pham-quyet-46994912", "francis-augusto-macatol-75099512", "lamnn", "nguyen-tran-phu-238a1012", "tuan-le-huu-1a9a3912", "thang-nguyen-manh-13ba4412", "doan-nguyen-msc-382b9b12", "thanhtran11", "namanh", "ngocntt", "ngan-pham-hoang-13b3b313", "christopher-liu-93345913", "bui-thuy-duong-7174b313", "binh-tran-7b162213", "linhnguyen0410", "dtlvan", "rahulverma03", "huynh-chau-94089013", "vinhhungle", "tracytrang", "onbhavinpatel", "phung-minh-chau-0b00a414", "tri%E1%BB%87u-quang-khanh-tommy-14511b14", "buddymorin", "phunv", "nguyenthivn", "phamkhanhhoa19", "hoang-nhan-16927714", "vu-nguyen-82438a14", "rosella-dang-35645214", "luanvk", "hpham8x", "dario-passon-73755b14", "thuttm1", "ung-ngoc-quoc-thai-47a76b14", "nguyendo", "danieltranat", "phuongngo", "lehongphuc", "trantuan", "koji-notsu-2bb2b615", "vo-thanh-tam-7502b915", "nguyen-viet-duc-31b4b415", "chinh-vo-60453715", "kqhung", "tien-phung-tuong-oanh-9b587415", "trucmai", "val-green-263a3415", "hien-nguyen-b7ba4315", "thanhvan1707", "ly-duong-b25b0015", "lhnha", "vu-tu-uyen-21219216", "h%C3%A0-l%C3%AA-thu-94921316", "lukas-anh-nguyen-09123916", "porametboo", "phuonghoangmath", "nguyenxuandinh", "nam-l%C3%BD-16272616", "xu%C3%A2n-ph%E1%BA%A1m-th%E1%BB%8B-anh-04373816", "viet-pham-9b684516", "binh-phan", "khai-le-69289016", "hvphuc", "tr%C3%A2%CC%80n-vi%CC%83nh-phi-long-879b5816", "hang-le-thi-nhu-433b5b16", "thomas-ducret-ba9b6216", "kim-anh-nguyen-01814417", "minniebui", "duong-pham-14223817", "vananh2205", "dungtiendinh", "phuoc-trinh-27a64417", "vietnguyenquoc", "quang-hoang-a5a93917", "pham-anh-vu-9a39aa17", "son-pham-182a1717", "luigi-battafarano-096a5817", "nguyenduchuy", "huyentranhr", "vi-nguyen-62bbba17", "hoanghoa", "phult", "trang-luong-97727218", "duongphuonghong", "phuong-mai-nguyen-53933518", "vu-vo-89a37718", "namlehoai", "phuc-nguyen-8b854218", "trungnv", "thaitd", "lan-dang-28274b18"];

function getPDFProfile(dmsLink, idProfile) {
    var req = new XMLHttpRequest();
    req.open("GET", dmsLink);
    var namePDF = decodeURI(idProfile);
    console.log(namePDF);
    req.responseType = "blob";
    req.onreadystatechange = function () {
        if (req.readyState === 4 && req.status === 200) {
            var filename = namePDF + ".pdf";
            if (typeof window.chrome !== 'undefined') {
                // Chrome version
                var link = document.createElement('a');
                link.href = window.URL.createObjectURL(req.response);
                link.download = namePDF + ".pdf";
                link.click();
            } else if (typeof window.navigator.msSaveBlob !== 'undefined') {
                // IE version
                var blob = new Blob([req.response], {type: 'application/pdf'});
                window.navigator.msSaveBlob(blob, filename);
            } else {
                // Firefox version
                var file = new File([req.response], filename, {type: 'application/force-download'});
                window.open(URL.createObjectURL(file));
            }
        }
    };
    req.send();
}

// send POST pdf profile
function getCookie(name) {
    var value = "; " + document.cookie;
    var parts = value.split("; " + name + "=");
    if (parts.length == 2) return parts.pop().split(";").shift().replace('"', '').replace('"', '');
}

var csrfToken = getCookie('JSESSIONID');
console.log(csrfToken);

// send POST pdf profile
function POSTRequest(idProfile) {
    var linkRequest = "https://www.linkedin.com/voyager/api/identity/profiles/" + idProfile + "/profileActions?versionTag=3123833624&action=saveToPdf";
    var xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function () {
        if (this.readyState == 4 && this.status == 200) {

            var parsedData = JSON.parse(this.responseText);
            // console.log(parsedData.value);
            getPDFProfile(parsedData.value, idProfile);
        }
    };
    xhttp.open("POST", linkRequest, true);
    xhttp.setRequestHeader("csrf-token", csrfToken);
    xhttp.send();
}
var succeedGetProfile = [];
var failGetProfile = [];
function main() {
    var promises = [];
    profileId.forEach(function (entry) {
        promises.push(POSTRequest(entry));
    });
    Promise.all(promises).then(dataResponse => {
        dataResponse.forEach(function (pdfFile) {
            console.log("aaaa");
        });
    });
}
main();